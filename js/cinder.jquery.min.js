(function(){function n(b,a){if(b.length&&(b=b[0],1<b.length))return!1;var d=new p(b,a);f.push(d);return d}function p(b,a){t(q,this,u,a);this.$element=$(b).addClass("cinder-active").css("position","relative");this.redraw(!0)}function t(b,a){for(var d=!1,c=2;c<arguments.length;c++){var g=arguments[c],e;for(e in g)0<=b.indexOf(e)&&a[e]!=g[e]&&(a[e]=g[e],d=!0)}return d}function x(){l&&(clearTimeout(l),l=null);l=setTimeout(function(){for(var b=0;b<f.length;b++)f[b].redraw();l=null},100)}function v(){if(!l&&
r){for(var b=0;b<f.length;b++){var a=f[b];"css"==a.animation&&a.$element.children().each(function(){var b=$(this),a=$(this).data("cinder-style"),g={width:a.width,height:a.height,position:"absolute"};a.top&&a.left&&(h?g[h+"transform"]="translate3d("+a.left+","+a.top+",0px)":(g.left=a.left,g.top=a.top));b.css(g)})}r=!1}window.requestAnimationFrame(v)}var f=[],r,l,u={columns:3,gap:4,ratio:null,filter:"*",animation:"css",onFirstLayout:null,onLayout:null,onDestroy:null,layout:"default"},q=function(b){if(b.keys)return b.keys();
var a=[];$.each(b,function(b){a.push(b)});return a}(u),y=["","-o-","-moz-","-ms-","-webkit-"];$("<div/>");var h,w={};n.VERSION="0.4.0";n.registerLayout=function(b,a,d){w[b]={fn:a,options:d}};n.registerLayout("default",function(b,a,d,c){var g=/^\d+\.?\d+?$/.test(b.ratio)?b.ratio-0:null,e=[],f=[],l=[],h=/^(\d+\.?\d*?)(px|%)?$/.exec(b.columns);c=h[1]-0;var m=1;if(h[2]){for(;m*c+gap*(m-1)<d;)m++;c=m}m=(a-gap*(c-1))/c;for(a=0;a<c;)e[a]=0,l[a]=[],f[a]=m+(0>columns-a?1:0),a++;b.$element.addClass("cinder-static").children().each(function(){var a=
$(this),c=a.data("cinder-ratio");if(!c){var d=a.innerWidth();c=a.innerHeight();d&&c?(c=d/c,a.data("cinder-ratio",c)):c=g}d=e.indexOf(Math.min.apply(Math,e));var k=a.css(["padding-left","padding-right"]);k=f[d]-parseInt(k.paddingLeft)-parseInt(k.paddingRight)+"px";c=c?Math.round(1*m/c)+"px":null;k={width:k,height:c||"auto"};l[d].push(element);if(!c){var h={width:k.width,height:k.height};a.css(k);k.height=a.css("height");c=parseInt(element.offsetHeight);a.css(h)}a.data("cinder-style",k);e[d]+=parseFloat(c)+
b.gap}).end().removeClass("cinder-static")},{resize:!0,balance:!0});$.extend(p.prototype,{redraw:function(b){var a=this.$element.innerWidth(),d=this.element.innerHeight();if(b||a!=this.width){b=w[this.layout.name||this.layout];b.fn(this,a,d,this.layout.options||b.options);this.width=a;this.height=d;if(!this.ready){var c=this;setTimeout(function(){c.ready=!0;c.$element.addClass("cinder-ready");c.afterFirstLayout&&(c.afterFirstLayout(c),c.afterFirstLayout=null)},1)}r=!0}},pause:function(){this.$element.addClass("cinder-paused")},
unpause:function(){this.$element.removeClass("cinder-paused")},sort:function(b,a){a&&this.pause();for(var d in this.element.children);a&&this.unpause();this.redraw(!0)},destroy:function(){this.$element.removeClass("cinder-active");if("function"==typeof this.onDestroy)this.onDestroy(this.$element[0]);f.splice(f.indexOf(this),1)},set:function(b,a){changed=!1;"[object String]"==b.toString()?-1<q.indexOf(b)&&this[b]!=a&&(this[b]=a,changed=!0):changed=t(q,this,b);changed&&this.redraw(!0)}});$.fn.Cinder=
function(b){var a;if("object"==typeof b||!b)return this.each(function(){a=new p(this,b);$(this).data("cinder",a);f.push(a)})};for($("body").append($div);(h=y.pop())&&($div.css(h+"transform","translateZ(9px)"),!$div.css(h+"transform")););$div.remove();$(window).resize(function(){x()});window.requestAnimationFrame(v)})($);